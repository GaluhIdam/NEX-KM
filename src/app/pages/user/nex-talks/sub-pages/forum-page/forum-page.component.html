<!-- Search & Trend Section -->
<div class="flex justify-center py-20 bg-center bg-library">
  <div class="grid grid-rows-2 gap-4 max-[600px]:px-3">
    <div class="min-[600px]:w-[32rem] place-self-center">
      <h1
        class="text-white font-bold text-center min-[600px]:text-4xl max-[600px]:text-2xl"
      >
        Explore New Experience of Collaboration
      </h1>
    </div>
    <div
      class="relative mb-4 flex min-[600px]:w-[800px] flex-wrap items-stretch bg-white rounded-full mt-4"
    >
      <button
        class="relative z-[2] rounded-l px-4 py-2 text-xs font-medium uppercase leading-tight text-primary transition duration-150 ease-in-out hover:bg-black hover:bg-opacity-5"
        type="button"
        id="button-addon1"
      >
        <fa-icon [icon]="faSearch" class="text-black"></fa-icon>
      </button>
      <input
        type="text"
        class="h-11 relative m-0 block w-[1px] min-w-0 flex-auto rounded-r bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition ease-in-out"
        placeholder="Search"
        aria-label="Example text with button addon"
        aria-describedby="button-addon1"
      />
    </div>
    <h1 class="text-white">TRENDING SEARCH</h1>
    <div>
      <ul
        class="flex flex-wrap pl-0 list-none md:flex-row"
        role="tablist"
        data-te-nav-ref
      >
        <li class="mx-2 mb-2">
          <button
            type="button"
            class="px-4 py-1 text-white bg-transparent border rounded-full border-1 hover:bg-white hover:text-black"
          >
            Travelling
          </button>
        </li>
        <li class="mx-2 mb-2">
          <button
            type="button"
            class="px-4 py-1 text-white bg-transparent border rounded-full border-1 hover:bg-white hover:text-black"
          >
            Interior Design
          </button>
        </li>
        <li class="mx-2 mb-2">
          <button
            type="button"
            class="px-4 py-1 text-white bg-transparent border rounded-full border-1 hover:bg-white hover:text-black"
          >
            Music
          </button>
        </li>
        <li class="mx-2 mb-2">
          <button
            type="button"
            class="px-4 py-1 text-white bg-transparent border rounded-full border-1 hover:bg-white hover:text-black"
          >
            Dancing
          </button>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Header -->
<div class="w-11/12 mx-auto mt-8">
  <div>
    <p class="mb-4 text-5xl font-semibold text-blue-800">NEX FORUM</p>
  </div>
  <div class="flex justify-between">
    <div class="flex min-[600px]:justify-start max-[600px]:justify-center">
      <a class="mr-3 text-gray-400" routerLink="/">Home</a>
      <fa-icon [icon]="faChevronRight" class="mr-3 text-gray-400"></fa-icon>
      <a routerLink="/user/nex-talks" class="mr-3 text-gray-400">Nex Talk</a>
      <fa-icon [icon]="faChevronRight" class="mr-3 text-gray-400"></fa-icon>
      <p class="mr-3 text-black activeLink">Forum</p>
    </div>
    <div class="flex min-[600px]:justify-end max-[600px]:justify-center">
      <a
        type="button"
        data-te-ripple-init
        data-te-ripple-color="light"
        routerLink="/user/nex-talks/forum/post"
        class="w-fit inline-block rounded bg-new-primary px-3 py-2 text-sm max-[600px]:text-xs uppercase text-white shadow-[0_4px_9px_-4px_#3b71ca] transition duration-150 ease-in-out hover:bg-new-primary-600 hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:bg-new-primary-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-new-primary-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)]"
      >
        <fa-icon [icon]="faBookOpen" class="mr-2 text-white"></fa-icon>
        Post Forum
      </a>
    </div>
  </div>
</div>

<!-- Content -->
<div class="px-20 py-5 mt-8 bg-gray-50">
  <div class="grid gap-5 mt-5 lg:grid-cols-4 xs:grid-cols-1">
    <!-- Left -->
    <ng-container *ngIf="isCategoryLoading">
      <div class="flex items-center justify-center min-h-screen font-semibold">
        <app-loading></app-loading>
      </div>
    </ng-container>
    <ng-container *ngIf="!isCategoryLoading">
      <div class="flex flex-col py-3 bg-white shadow-md rounded-xl">
        <p class="px-4 py-2 font-semibold text-gray-500">SPACES</p>
        <ng-container *ngFor="let category of talkCategoryData">
          <div
            class="flex flex-row items-center justify-start px-4 py-2 rounded-2xl"
            [class.bg-soft-green]="selectedTalkCategory?.name === category.name"
          >
            <div
              (click)="onChangeTalkCategory(category)"
              [class.text-white]="selectedTalkCategory?.name === category.name"
              [class.font-semibold]="
                selectedTalkCategory?.name === category.name
              "
            >
              {{ category.name }}
            </div>
          </div>
        </ng-container>
        <!-- <div href="#" class="px-4 py-2 hover:bg-gray-100">For You</div> -->
      </div>
    </ng-container>

    <!-- Right -->
    <div class="col-span-3">
      <div class="flex justify-between mb-4">
        <div class="flex justify-start gap-3">
          <p
            class="text-base font-semibold text-blue-500 underline cursor-pointer"
            [class.text-gray-400]="sortBy !== 'forumComment'"
            [class.underline]="sortBy === 'forumComment'"
            (click)="onChangeOrderForum('ForumComment')"
          >
            Hot Forum
          </p>
          <p
            class="text-base font-semibold text-blue-500 cursor-pointer"
            [class.text-gray-400]="sortBy !== 'desc'"
            [class.underline]="sortBy === 'desc'"
            (click)="onChangeOrderForum('Recent')"
          >
            Recent Forum
          </p>
        </div>
        <div
          class="flex flex-wrap justify-end bg-gray-100 shadow-md lg:-mt-3 xs:mt-2 lg:w-80 xs:w-full rounded-xl"
        >
          <button
            class="relative z-[2] rounded-l px-4 py-2 text-xs font-medium uppercase leading-tight text-primary transition duration-150 ease-in-out hover:bg-black hover:bg-opacity-5"
            type="button"
            id="button-addon1"
          >
            <fa-icon [icon]="faSearch" class="text-gray-400"></fa-icon>
          </button>
          <input
            type="text"
            class="h-11 relative m-0 block w-[1px] min-w-0 flex-auto rounded-r bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition ease-in-out"
            placeholder="Search For Topics"
            aria-label="Example text with button addon"
            aria-describedby="button-addon1"
            (keyup)="searchByField($event)"
          />
        </div>
      </div>
      <ng-container *ngIf="isForumLoading">
        <div class="flex items-center justify-center h-screen">
          <app-loading></app-loading>
        </div>
      </ng-container>
      <ng-container *ngIf="!isForumLoading">
        <ng-container *ngIf="forumData.length > 0; else emptyForumData">
          <div class="flex flex-col justify-between min-h-screen">
            <div>
              <!-- Loop here -->
              <ng-container *ngFor="let forum of forumData; let i = index">
                <div
                  class="block w-full p-6 mb-3 bg-white rounded-lg shadow-lg"
                >
                  <div class="flex flex-row">
                    <div class="flex flex-col justify-center mr-5">
                      <fa-icon
                        [icon]="faChevronUp"
                        class="cursor-pointer hover:text-regal-blue"
                        (click)="
                          !isForumVoteLoading[i]
                            ? onChangeForumVote(
                                i,
                                forum.id,
                                this.personalNumber,
                                true
                              )
                            : null
                        "
                      ></fa-icon>
                      <p
                        class="text-lg font-bold text-center"
                        [class]="
                          calculateForumVote(forum.forumVote) >= 0
                            ? 'text-regal-blue'
                            : 'text-red-500'
                        "
                      >
                        {{
                          convertedForumCountValue(
                            calculateForumVote(forum.forumVote)
                          )
                        }}
                      </p>
                      <fa-icon
                        [icon]="faChevronDown"
                        class="cursor-pointer hover:text-red-500"
                        (click)="
                          !isForumVoteLoading[i]
                            ? onChangeForumVote(
                                i,
                                forum.id,
                                this.personalNumber,
                                false
                              )
                            : null
                        "
                      ></fa-icon>
                    </div>
                    <div class="w-full">
                      <div class="grid grid-cols-2">
                        <div>
                          <h5
                            class="mb-2 text-xl font-medium leading-tight text-neutral-800"
                          >
                            {{ forum.title }}
                          </h5>
                          <span>
                            <span
                              class="inline-block whitespace-nowrap rounded-full bg-blue-300 hover:bg-blue-400 px-[0.65em] pt-[0.35em] pb-[0.25em] text-center align-baseline text-[0.75em] font-bold leading-none text-white"
                            >
                              <fa-icon
                                [icon]="faTag"
                                class="mr-2 text-white"
                              ></fa-icon>
                              {{ forum.talkCategory.name }}
                            </span>
                          </span>
                        </div>
                        <div class="text-right">
                          <a
                            data-te-dropdown-item-ref
                            data-te-toggle="modal"
                            [attr.data-te-target]="'#shareModal' + forum.uuid"
                            data-te-ripple-init
                            data-te-ripple-color="light"
                          >
                            <fa-icon
                              [icon]="faShareNodes"
                              class="text-xl text-gray-400 cursor-pointer"
                            ></fa-icon>
                          </a>
                        </div>
                        <app-share-modal
                          [uuid]="forum.uuid"
                          [content]="'forum'"
                          [urlToShare]="
                            'http://172.16.41.107:3011/user/nex-talks/forum/comments/' +
                            forum.uuid
                          "
                        ></app-share-modal>
                      </div>
                      <img
                        *ngIf="forum.path !== '-'"
                        [src]="forum.path"
                        [alt]="forum.title"
                        class="mt-3 rounded-3xl min-[600px]:w-1/2 min-[600px]:h-80 max-[600px]:w-full max-[600px]:h-60"
                      />
                      <ng-container
                        *ngIf="parsedForumDescriptions[i].length > 1000"
                      >
                        <ng-container *ngIf="isShowMoreButtonClicked[i]">
                          <p
                            class="mt-3 mb-4 text-base text-neutral-600"
                            [innerHTML]="parsedForumDescriptions[i]"
                          ></p>
                        </ng-container>
                        <ng-container *ngIf="!isShowMoreButtonClicked[i]">
                          <p
                            class="mt-3 mb-4 text-base text-neutral-600"
                            [innerHTML]="
                              parsedForumDescriptions[i].substr(0, 1000) + '...'
                            "
                          ></p>
                        </ng-container>

                        <button
                          class="p-2 mb-4 text-xs font-bold text-blue-500 bg-blue-100 rounded-xl w-fit hover:shadow-lg"
                          [hidden]="isShowMoreButtonClicked[i]"
                          (click)="onClickedShowMoreButton(i)"
                        >
                          Show More
                        </button>
                        <button
                          class="p-2 mb-4 text-xs font-bold text-blue-500 bg-blue-100 rounded-xl w-fit hover:shadow-lg"
                          [hidden]="!isShowMoreButtonClicked[i]"
                          (click)="onClickedShowMoreButton(i)"
                        >
                          Show Less
                        </button>
                      </ng-container>

                      <ng-container
                        *ngIf="parsedForumDescriptions[i].length < 1000"
                      >
                        <p
                          class="mt-3 mb-4 text-base text-neutral-600"
                          [innerHTML]="parsedForumDescriptions[i]"
                        ></p>
                      </ng-container>
                      <hr />
                      <div class="grid grid-cols-2">
                        <div class="flex items-center mt-3 space-x-4">
                          <div class="flex-shrink-0">
                            <img
                              class="w-8 h-8 rounded-full"
                              [src]="
                                forumUploaders[i].userPhoto !== ''
                                  ? forumUploaders[i].userPhoto
                                  : '../../../../assets/image/empty-profile-image.jpeg'
                              "
                              alt="forum uploader"
                            />
                          </div>
                          <div class="flex min-w-0 gap-2">
                            <p class="text-base font-medium text-gray-500">
                              Posted by
                            </p>
                            <p
                              class="text-base text-blue-500 cursor-pointer hover:text-blue-400"
                              (click)="
                                forumUploaders[i].personalNumber !== ''
                                  ? onGotoUserPage(
                                      forumUploaders[i].personalNumber
                                    )
                                  : undefined
                              "
                            >
                              {{ forumUploaders[i].userName }}
                            </p>
                            <p class="text-base text-gray-500">
                              {{ calculateTimeDifference(forum.createdAt) }}
                            </p>
                          </div>
                        </div>
                        <div class="flex items-center justify-end mt-3">
                          <span
                            class="flex items-center h-full gap-2 text-blue-600 cursor-pointer"
                            (click)="forumComment(forum.uuid)"
                          >
                            <fa-icon
                              [icon]="faMessage"
                              class="text-xl text-gray-400"
                            ></fa-icon>
                            <p>
                              {{ filteredForumComments(forum.forumComment) }} +
                            </p>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
            <!-- Pagination -->
            <div
              class="flex items-center justify-start mt-5"
              *ngIf="paginator && !isForumLoading"
            >
              <h1 class="mr-5">Total : {{ paginator.totalData }}</h1>
              <div class="flex items-center justify-start mx-10">
                <span class="text-sm">Show</span>
                <select
                  *ngIf="paginator"
                  [(ngModel)]="paginator.pageSize"
                  (ngModelChange)="changePageSize()"
                  class="bg-gray-50 border border-gray-300 text-gray-700 text-sm rounded-lg focus:ring-blue-300 focus:border-blue-300 block py-1.5 pl-2 pr-7 mx-2 hover:cursor-pointer"
                >
                  <option
                    *ngFor="let size of paginator?.pageOption"
                    [ngValue]="size"
                  >
                    {{ size }} data
                  </option>
                </select>
              </div>
              <div class="flex items-center justify-center mx-3">
                <button
                  type="button"
                  (click)="changePageNumber(false)"
                  [disabled]="paginator.pageNumber == 1"
                  [class]="
                    paginator.pageNumber == 1 ? 'bg-gray-200' : 'bg-gray-50'
                  "
                  class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-300 rounded-lg active:bg-gray-200 active:border-blue-300"
                >
                  Previous
                </button>
                <!-- <button
                      class="ml-2 text-gray-400"
                      (click)="goToPageNumberByPageClick(i + 1)"
                      *ngFor="let page of pages; let i = index"
                    >
                      {{ i + 1 }}
                    </button> -->
                <button
                  type="button"
                  (click)="changePageNumber(true)"
                  [disabled]="paginator.pageNumber == paginator.totalPage"
                  [class]="
                    paginator.pageNumber == paginator.totalPage
                      ? 'bg-gray-200'
                      : 'bg-gray-50'
                  "
                  class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 border border-gray-300 rounded-lg active:bg-gray-200 active:border-blue-300 ml-2"
                >
                  Next
                </button>
              </div>
              <h1 class="w-fit">Go to Page</h1>
              <select
                *ngIf="paginator"
                [(ngModel)]="paginator.pageNumber"
                (ngModelChange)="goToPageNumberByPageSelect($event)"
                class="bg-gray-50 border border-gray-300 text-gray-700 text-sm rounded-lg focus:ring-blue-300 focus:border-blue-300 block py-1.5 pl-2 pr-7 mx-2 hover:cursor-pointer"
              >
                <option
                  *ngFor="let page of pages; let i = index"
                  [ngValue]="i + 1"
                >
                  {{ i + 1 }}
                </option>
              </select>
            </div>
            <!-- Pagination -->
          </div>
        </ng-container>
        <ng-template #emptyForumData>
          <div class="flex items-center justify-center h-screen">
            <h2>No Forums available.</h2>
          </div>
        </ng-template>
      </ng-container>
    </div>
  </div>
</div>
